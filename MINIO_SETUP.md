# Настройка MinIO для логирования в Templify

Этот документ описывает, как настроить MinIO для хранения логов в проекте Templify, аналогично проекту Elomoas.

## Что такое MinIO?

MinIO - это объектное хранилище, совместимое с Amazon S3, которое позволяет хранить и управлять файлами (в нашем случае - логами) в облачном стиле.

## Установка MinIO

### 1. Скачивание MinIO

1. Перейдите на официальный сайт MinIO: https://min.io/download
2. Скачайте версию для Windows (minio.exe)
3. Создайте папку `C:\minio\`
4. Поместите `minio.exe` в папку `C:\minio\`

### 2. Запуск MinIO сервера

1. Откройте PowerShell от имени администратора
2. Выполните команду:
```powershell
C:\minio\minio.exe server C:\minio\data --console-address ":9001"
```

3. Сервер MinIO будет доступен по адресу: http://localhost:9001
4. Консоль управления: http://localhost:9001

### 3. Настройка доступа

По умолчанию MinIO использует следующие учетные данные:
- **Access Key**: `minioadmin`
- **Secret Key**: `minioadmin`

Эти данные уже настроены в `appsettings.json`.

## Настройка проекта

### 1. Конфигурация

В файле `appsettings.json` уже настроены параметры MinIO:

```json
"MinioSettings": {
  "Endpoint": "localhost:9000",
  "AccessKey": "minioadmin",
  "SecretKey": "minioadmin",
  "UseSSL": false,
  "BucketName": "templify-logs"
}
```

### 2. NuGet пакеты

Проект уже содержит необходимый пакет `Minio` версии 8.0.0.

## Функциональность

### Автоматическое логирование

- Логи автоматически синхронизируются с MinIO каждые 5 минут
- При достижении 100 записей в очереди - синхронизация происходит немедленно
- Логи сохраняются в формате JSON с метаданными

### Типы логов

1. **User Actions** - действия пользователей (логин, регистрация, выход)
2. **Security Events** - события безопасности (попытки входа, IP адреса)
3. **Business Events** - бизнес-события (регистрация пользователей)
4. **Database Operations** - операции с базой данных
5. **Performance Metrics** - метрики производительности

### Архивация

- Локальные файлы логов автоматически архивируются в MinIO
- После успешной архивации локальные файлы удаляются
- Архивы сохраняются с временными метками

## Управление логами через админ панель

### Доступ

Перейдите в админ панель → **Logs Management**

### Функции

1. **Sync Logs to MinIO** - принудительная синхронизация логов
2. **Archive Local Logs** - архивация локальных файлов логов
3. **View Log** - просмотр содержимого лога
4. **Download Log** - скачивание лога
5. **Delete Log** - удаление лога из MinIO

## Структура логов в MinIO

### Bucket: `templify-logs`

Логи сохраняются в следующих форматах:

1. **logs-{timestamp}.json** - текущие логи приложения
2. **archive-{timestamp}-{filename}** - архивированные файлы

### Формат JSON лога

```json
{
  "timestamp": "2024-01-15T10:30:00Z",
  "level": "Information",
  "category": "UserAction",
  "action": "Login",
  "details": "User logged in successfully",
  "userId": "user@example.com",
  "ipAddress": "192.168.1.1",
  "data": null,
  "duration": null,
  "metricValue": null,
  "metricUnit": null
}
```

## Мониторинг и обслуживание

### Проверка состояния

1. Откройте консоль MinIO: http://localhost:9001
2. Войдите с учетными данными: `minioadmin` / `minioadmin`
3. Проверьте bucket `templify-logs`
4. Убедитесь, что логи загружаются

### Очистка старых логов

1. В админ панели перейдите в **Logs Management**
2. Используйте функцию **Archive Local Logs** для архивации
3. Удалите старые архивы через консоль MinIO при необходимости

## Устранение неполадок

### MinIO не запускается

1. Убедитесь, что порт 9000 не занят другими службами
2. Проверьте права доступа к папке `C:\minio\`
3. Запустите PowerShell от имени администратора

### Логи не загружаются в MinIO

1. Проверьте подключение к MinIO в консоли
2. Убедитесь, что bucket `templify-logs` создан
3. Проверьте настройки в `appsettings.json`
4. Просмотрите логи приложения на предмет ошибок

### Ошибки аутентификации

1. Проверьте Access Key и Secret Key в `appsettings.json`
2. Убедитесь, что MinIO сервер запущен
3. Проверьте настройки SSL (должно быть `false` для локальной разработки)

## Преимущества использования MinIO

1. **Централизованное хранение** - все логи в одном месте
2. **Масштабируемость** - легко увеличить объем хранилища
3. **Безопасность** - контроль доступа к логам
4. **Архивация** - автоматическое резервное копирование
5. **Анализ** - удобный просмотр и анализ логов
6. **Совместимость** - стандарт S3 API

## Ссылки

- [Официальный сайт MinIO](https://min.io/)
- [Документация MinIO](https://docs.min.io/)
- [Проект Elomoas](https://github.com/NikitinRadmir/Elomoas/tree/dev/)

